<!doctype html>
<html lang="ja">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Day08 â€” ç‚ºæ›¿ãƒ¬ãƒ¼ãƒˆå¤‰æ›ã‚¢ãƒ—ãƒª</title>
  <meta name="description" content="ExchangeRate-API ã‚’åˆ©ç”¨ã—ãŸå­¦ç¿’ç”¨é€šè²¨ã‚³ãƒ³ãƒãƒ¼ã‚¿ãƒ¼ã€‚ã‚­ãƒ£ãƒƒã‚·ãƒ¥ãƒ»å±¥æ­´ãƒ»ãŠæ°—ã«å…¥ã‚Šãƒ»ã‚¹ãƒ¯ãƒƒãƒ—å¯¾å¿œã€‚GitHub Pages ã§å‹•ãå˜ä¸€HTMLã€‚">
  <style>
    :root{
      --bg:#0b1020; --panel:#121836; --text:#e9ecf1; --muted:#9aa3b2; --accent:#7aa2ff; --ok:#6efacc; --bad:#ff6b6b;
      --edge:#2a3566; --card:#0f1430; --shadow:0 10px 24px rgba(0,0,0,.35);
    }
    *{box-sizing:border-box}
    html,body{height:100%}
    body{
      margin:0; color:var(--text);
      background:radial-gradient(1000px 500px at 80% -10%,#16204a,transparent),var(--bg);
      font-family:system-ui,-apple-system,Segoe UI,Roboto,Helvetica,Arial,"Noto Sans JP",sans-serif;
      display:grid; place-items:center;
    }
    .app{
      width:min(96vw,880px);
      background:linear-gradient(180deg,rgba(255,255,255,.03),transparent),var(--panel);
      border:1px solid rgba(255,255,255,.06); border-radius:18px; box-shadow:var(--shadow);
      padding:20px 20px 24px;
    }
    header{display:flex; align-items:center; justify-content:space-between; gap:12px}
    h1{margin:0; font-size:18px}
    .sub{color:var(--muted); font-size:12px}
    .badge{display:inline-grid; place-items:center; padding:2px 8px; border-radius:999px; font-size:12px;
      border:1px solid var(--edge); background:var(--card); color:var(--muted)}
    .badge.live{color:#bfe0ff; border-color:#365fa8}
    .badge.cache{color:#bafbe9; border-color:#2a7e68}
    .grid{display:grid; gap:14px; margin-top:14px}
    .card{background:var(--card); border:1px solid var(--edge); border-radius:14px; padding:14px}
    .row{display:flex; gap:10px; flex-wrap:wrap; align-items:center}
    input[type=number], select{
      padding:10px 12px; border-radius:12px; border:1px solid var(--edge); background:#0d1330; color:var(--text); min-width:120px;
      font-size:14px;
    }
    .result{
      display:flex; align-items:center; justify-content:space-between; gap:10px;
      padding:12px; border-radius:12px; background:#0d1330; border:1px solid var(--edge); font-size:16px
    }
    .mono{font-variant-numeric:tabular-nums; font-family:ui-monospace, SFMono-Regular, Menlo, Consolas, monospace}
    .btn{
      border:0; border-radius:12px; padding:10px 14px; font-weight:700; cursor:pointer; transition:transform .05s ease;
      background:#0d1330; color:var(--text); border:1px solid var(--edge); min-height:40px
    }
    .btn:active{transform:translateY(1px)}
    .btn.primary{background:linear-gradient(180deg,var(--accent),#557aff); color:#071022}
    .btn.ghost{background:#0d1330}
    .btn.good{background:linear-gradient(180deg,var(--ok),#4eddb5); color:#05231a}
    .btn.icon{aspect-ratio:1/1; width:42px; display:grid; place-items:center; font-size:18px}
    .error{color:#ffd6de}
    .muted{color:var(--muted)}
    .pill{
      padding:6px 10px; border-radius:999px; border:1px solid var(--edge); background:#0d1330; cursor:pointer; font-size:13px;
    }
    .pill.active{outline:2px solid var(--accent); outline-offset:1px}
    .favorites{display:flex; gap:8px; flex-wrap:wrap}
    .history{display:grid; gap:8px}
    .history .item{display:flex; justify-content:space-between; align-items:center; gap:10px; background:#0d1330; border:1px solid var(--edge); border-radius:12px; padding:10px}
    .small{font-size:12px}
    .kbd{font-family:ui-monospace, SFMono-Regular, Menlo, Consolas, monospace; background:#0f1430; border:1px solid #28305b; padding:2px 6px; border-radius:6px;}
    a{color:#9dd5ff; text-decoration:none}
  </style>
</head>
<body>
  <main class="app" role="application" aria-labelledby="title">
    <header>
      <div>
        <h1 id="title">Currency Converter</h1>
        <div class="sub">Day08 â€” å¤–éƒ¨ãƒ‡ãƒ¼ã‚¿ï¼ˆExchangeRate-APIï¼‰ï¼‹çŠ¶æ…‹ç®¡ç†ï¼‹å®Ÿç”¨UIï½œEnter=æ›ç®—ãƒ»<span class="kbd">S</span>=ã‚¹ãƒ¯ãƒƒãƒ—</div>
      </div>
      <div class="row">
        <span id="statusBadge" class="badge">â€”</span>
        <span id="updatedAt" class="small muted"></span>
      </div>
    </header>

    <section class="grid">
      <!-- å…¥åŠ›ã¨é€šè²¨é¸æŠ -->
      <div class="card" aria-label="æ›ç®—ãƒ•ã‚©ãƒ¼ãƒ ">
        <div class="row">
          <label>é‡‘é¡
            <input id="amount" type="number" inputmode="decimal" min="0" step="any" placeholder="é‡‘é¡ã‚’å…¥åŠ›" />
          </label>
        </div>
        <div class="row" style="margin-top:10px">
          <label>From
            <select id="from"></select>
          </label>

          <button id="swap" class="btn icon" aria-label="From/To ã‚’å…¥ã‚Œæ›¿ãˆ">â†”</button>

          <label>To
            <select id="to"></select>
          </label>
        </div>

        <div id="formError" class="small error" role="alert" style="margin-top:8px"></div>

        <div class="result" style="margin-top:10px" aria-live="polite" aria-atomic="true">
          <div id="resultText" class="mono">â€”</div>
          <button id="copyBtn" class="btn ghost icon" title="çµæœã‚’ã‚³ãƒ”ãƒ¼" aria-label="çµæœã‚’ã‚³ãƒ”ãƒ¼">â§‰</button>
        </div>
        <div class="small muted" id="rateNote" style="margin-top:6px"></div>
      </div>

      <!-- ãŠæ°—ã«å…¥ã‚Šé€šè²¨ -->
      <div class="card" aria-label="ãŠæ°—ã«å…¥ã‚Šé€šè²¨">
        <div class="row" style="justify-content:space-between">
          <strong>ãŠæ°—ã«å…¥ã‚Šé€šè²¨</strong>
          <span class="small muted">ã‚¯ãƒªãƒƒã‚¯ã§ From ã«è¨­å®šï¼ˆé•·æŠ¼ã—ã§ Toï¼‰</span>
        </div>
        <div id="favWrap" class="favorites" style="margin-top:10px"></div>
      </div>

      <!-- å±¥æ­´ -->
      <div class="card" aria-label="å±¥æ­´">
        <div class="row" style="justify-content:space-between">
          <strong>å±¥æ­´ï¼ˆç›´è¿‘10ä»¶ï¼‰</strong>
          <div class="row">
            <button id="clearHistory" class="btn ghost small">å±¥æ­´ã‚¯ãƒªã‚¢</button>
          </div>
        </div>
        <div id="history" class="history" style="margin-top:10px"></div>
      </div>
    </section>

    <footer class="row" style="justify-content:space-between; margin-top:10px">
      <div class="small muted">ãƒ‡ãƒ¼ã‚¿æä¾›: <a href="https://www.exchangerate-api.com/" target="_blank" rel="noopener">ExchangeRate-API</a>ï¼ˆå­¦ç¿’ç”¨ç„¡æ–™ã‚­ãƒ¼ï¼‰</div>
      <div class="small muted">ä¿å­˜å…ˆ: LocalStorageï¼ˆã‚­ãƒ£ãƒƒã‚·ãƒ¥TTL=1æ™‚é–“ï¼UIçŠ¶æ…‹ï¼å±¥æ­´ï¼ãŠæ°—ã«å…¥ã‚Šï¼‰</div>
    </footer>

    <!-- ã‚¢ã‚¯ã‚»ã‚·ãƒ“ãƒªãƒ†ã‚£é€šçŸ¥ -->
    <div id="a11y" class="sr" aria-live="assertive"></div>
  </main>

<script>
/**
 * Day08 â€” ç‚ºæ›¿ãƒ¬ãƒ¼ãƒˆå¤‰æ›ã‚¢ãƒ—ãƒªï¼ˆå˜ä¸€HTMLï¼‰
 * - ExchangeRate-API ã‚’ä½¿ç”¨ï¼ˆå­¦ç¿’ãƒ»å€‹äººåˆ©ç”¨å‰æï¼‰
 * - 1æ™‚é–“ã‚­ãƒ£ãƒƒã‚·ãƒ¥ï¼å±¥æ­´10ä»¶ï¼ãŠæ°—ã«å…¥ã‚Šé€šè²¨ï¼ã‚¹ãƒ¯ãƒƒãƒ—ï¼ã‚³ãƒ”ãƒ¼
 * - å…¥åŠ›ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³ãƒ»APIå¤±æ•—æ™‚ãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯ï¼ˆã‚­ãƒ£ãƒƒã‚·ãƒ¥ãŒã‚ã‚Œã°åˆ©ç”¨ï¼‰
 * - ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£: ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆåŸ‹ã‚è¾¼ã¿ã‚­ãƒ¼ã¯éœ²å‡ºå‰æï¼ˆå­¦ç¿’ç”¨ï¼‰ã€‚å•†ç”¨æ™‚ã¯ã‚µãƒ¼ãƒçµŒç”±ãŒå¿…é ˆã€‚
 */
(function(){
  'use strict';

  // === ğŸ“ å¿…é ˆï¼šã“ã“ã«ã‚ãªãŸã® API ã‚­ãƒ¼ã‚’å…¥ã‚Œã¦ãã ã•ã„ ===
  // å…¬å¼: https://www.exchangerate-api.com/
  const API_KEY = '57ba9d54ff982b018381881b'; // â† â† ã“ã“ã‚’æ›¸ãæ›ãˆã‚‹
  // ==========================================================

  // â€”â€” å®šæ•°ãƒ»ã‚­ãƒ¼é¡ â€”â€”
  const API_BASE = 'https://v6.exchangerate-api.com/v6';
  const CACHE_TTL_MS = 60 * 60 * 1000; // 1æ™‚é–“
  const LS = {
    CACHE: 'cc-cache',       // { base, fetchedAt, conversion_rates }
    UI:    'cc-ui',          // { from, to, amount }
    FAV:   'cc-favorites',   // [ 'JPY', 'USD', ... ]
    HIST:  'cc-history'      // [ {amount, from, to, rate, result, ts} ]
  };
  const MAX_HISTORY = 10;

  // â€”â€” é€šè²¨å€™è£œï¼ˆä¸»è¦é€šè²¨ï¼‹ã‚¢ã‚¸ã‚¢ä¸­å¿ƒï¼‰ â€”â€”
  const CURRENCIES = [
    'JPY','USD','EUR','GBP','AUD','CAD','CHF','CNY','HKD','KRW','SGD','NZD','SEK','NOK','DKK','INR','THB','MYR','IDR','PHP','TWD'
  ];

  // â€”â€” è¦ç´ å‚ç…§ â€”â€”
  const $ = (s)=>document.querySelector(s);
  const amountEl = $('#amount');
  const fromSel = $('#from');
  const toSel = $('#to');
  const swapBtn = $('#swap');
  const resText = $('#resultText');
  const formError = $('#formError');
  const copyBtn = $('#copyBtn');
  const favWrap = $('#favWrap');
  const histWrap = $('#history');
  const clearHistoryBtn = $('#clearHistory');
  const statusBadge = $('#statusBadge');
  const updatedAtEl = $('#updatedAt');
  const rateNote = $('#rateNote');
  const a11y = $('#a11y');

  // â€”â€” ãƒ¦ãƒ¼ãƒ†ã‚£ãƒªãƒ†ã‚£ â€”â€”
  const pad2 = (n)=>n.toString().padStart(2,'0');
  const fmtMoney = (n)=> {
    if(typeof n !== 'number' || !isFinite(n)) return 'â€”';
    // ãƒ­ã‚±ãƒ¼ãƒ«éä¾å­˜ã®ç°¡æ˜“ãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆï¼ˆæ—¥æœ¬èªåœã§ã‚‚æ¡åŒºåˆ‡ã‚Šï¼‰
    return n.toLocaleString(undefined, {maximumFractionDigits: 2, minimumFractionDigits: 2});
  };
  function timeAgo(ts){
    const d = Date.now() - ts;
    if(d < 60_000) return 'ãŸã£ãŸä»Š';
    if(d < 3_600_000) return Math.floor(d/60_000)+'åˆ†å‰';
    if(d < 86_400_000) return Math.floor(d/3_600_000)+'æ™‚é–“å‰';
    const date = new Date(ts);
    return `${date.getFullYear()}/${pad2(date.getMonth()+1)}/${pad2(date.getDate())}`;
  }
  const saveLS = (k,v)=> localStorage.setItem(k, JSON.stringify(v));
  const loadLS = (k,fb)=> { try{ const v = JSON.parse(localStorage.getItem(k)||'null'); return v ?? fb; }catch(_){ return fb; } };

  // â€”â€” ã‚»ãƒ¬ã‚¯ãƒˆåˆæœŸåŒ–ï¼ˆãŠæ°—ã«å…¥ã‚Šã¯å¾Œã§ä¸Šä½ã«è¡¨ç¤ºï¼‰ â€”â€”
  function fillSelectOptions(select, items){
    select.innerHTML = '';
    items.forEach(code=>{
      const opt = document.createElement('option');
      opt.value = code; opt.textContent = code;
      select.appendChild(opt);
    });
  }

  // â€”â€” ãŠæ°—ã«å…¥ã‚Šé€šè²¨UI â€”â€”
  function renderFavorites(){
    const favs = loadLS(LS.FAV, ['JPY','USD','EUR']); // åˆæœŸãŠæ°—ã«å…¥ã‚Š
    favWrap.innerHTML = '';
    favs.forEach(code=>{
      const b = document.createElement('button');
      b.className = 'pill';
      b.textContent = code;
      // ã‚¯ãƒªãƒƒã‚¯ï¼Fromè¨­å®šã€é•·æŠ¼ã—ï¼ˆcontextmenuï¼‰ï¼Toè¨­å®š
      b.addEventListener('click', ()=>{ fromSel.value = code; announce('From ã‚’ '+code+' ã«è¨­å®š'); recalc(); saveUI(); });
      b.addEventListener('contextmenu', (e)=>{ e.preventDefault(); toSel.value = code; announce('To ã‚’ '+code+' ã«è¨­å®š'); recalc(); saveUI(); });
      favWrap.appendChild(b);
    });
    // ã‚»ãƒ¬ã‚¯ãƒˆã®å…ˆé ­ã« favs ã‚’ä¸¦ã¹ã€ãã‚Œä»¥å¤–ã‚’ç¶šã‘ã‚‹
    const rest = CURRENCIES.filter(c=> !favs.includes(c));
    const ordered = [...favs, ...rest];
    fillSelectOptions(fromSel, ordered);
    fillSelectOptions(toSel, ordered);
  }

  // â€”â€” å±¥æ­´UI â€”â€”
  function renderHistory(){
    const hist = loadLS(LS.HIST, []);
    histWrap.innerHTML = '';
    if(hist.length === 0){
      const empty = document.createElement('div');
      empty.className = 'small muted';
      empty.textContent = 'å±¥æ­´ã¯ã¾ã ã‚ã‚Šã¾ã›ã‚“';
      histWrap.appendChild(empty);
      return;
    }
    hist.forEach(h=>{
      const row = document.createElement('div');
      row.className = 'item';
      const left = document.createElement('div');
      left.innerHTML = `<div class="mono">${fmtMoney(h.amount)} ${h.from} â†’ ${h.to}</div>
                        <div class="small muted">${timeAgo(h.ts)}ãƒ»rate ${h.rate}</div>`;
      const right = document.createElement('div');
      right.className = 'mono';
      right.textContent = fmtMoney(h.result) + ' ' + h.to;
      row.appendChild(left); row.appendChild(right);
      histWrap.appendChild(row);
    });
  }

  // â€”â€” ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ãƒãƒƒã‚¸ â€”â€”
  function setStatus(kind, ts){
    statusBadge.className = 'badge';
    if(kind === 'live'){
      statusBadge.classList.add('live');
      statusBadge.textContent = 'Live';
      updatedAtEl.textContent = ts ? `æ›´æ–°: ${timeAgo(ts)}` : '';
    }else if(kind === 'cache'){
      statusBadge.classList.add('cache');
      statusBadge.textContent = 'Cache';
      updatedAtEl.textContent = ts ? `å–å¾—: ${timeAgo(ts)}` : '';
    }else{
      statusBadge.textContent = 'â€”';
      updatedAtEl.textContent = '';
    }
  }

  // â€”â€” API: æœ€æ–°ãƒ¬ãƒ¼ãƒˆå–å¾—ï¼ˆBASE=fromï¼‰ â€”â€”
  async function fetchRates(baseCode){
    // ã‚­ãƒ£ãƒƒã‚·ãƒ¥ã‚’ç¢ºèª
    const cache = loadLS(LS.CACHE, null);
    const now = Date.now();
    if(cache && cache.base === baseCode && (now - cache.fetchedAt) < CACHE_TTL_MS){
      setStatus('cache', cache.fetchedAt);
      return cache.conversion_rates;
    }
    // APIã‚­ãƒ¼æœªè¨­å®šã®ã‚¬ãƒ¼ãƒ‰
    if(!API_KEY || API_KEY === 'YOUR_API_KEY_HERE'){
      throw new Error('APIã‚­ãƒ¼ãŒè¨­å®šã•ã‚Œã¦ã„ã¾ã›ã‚“ï¼ˆã‚³ãƒ¼ãƒ‰ä¸Šéƒ¨ã® API_KEY ã‚’å·®ã—æ›¿ãˆã¦ãã ã•ã„ï¼‰');
    }
    // API å–å¾—
    const url = `${API_BASE}/${API_KEY}/latest/${encodeURIComponent(baseCode)}`;
    const res = await fetch(url);
    if(!res.ok) throw new Error('HTTPã‚¨ãƒ©ãƒ¼: '+res.status);
    const data = await res.json();
    if(data.result !== 'success' || !data.conversion_rates){
      throw new Error('APIãƒ¬ã‚¹ãƒãƒ³ã‚¹ä¸æ­£');
    }
    // ã‚­ãƒ£ãƒƒã‚·ãƒ¥ä¿å­˜
    const packed = { base: baseCode, fetchedAt: Date.now(), conversion_rates: data.conversion_rates };
    saveLS(LS.CACHE, packed);
    setStatus('live', packed.fetchedAt);
    return data.conversion_rates;
  }

  // â€”â€” å…¥åŠ›æ¤œè¨¼ â€”â€”
  function validate(){
    formError.textContent = '';
    const v = amountEl.value.trim();
    if(v === ''){ formError.textContent = 'é‡‘é¡ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„'; return false; }
    const n = Number(v);
    if(!isFinite(n) || n < 0){ formError.textContent = '0ä»¥ä¸Šã®æ•°å€¤ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„'; return false; }
    return true;
  }

  // â€”â€” è¨ˆç®— + è¡¨ç¤º + å±¥æ­´å‡¦ç† â€”â€”
  async function recalc(){
    if(!validate()) { resText.textContent = 'â€”'; return; }
    const amount = Number(amountEl.value);
    const from = fromSel.value, to = toSel.value;

    // From ã¨ To ãŒåŒã˜ãªã‚‰ãã®ã¾ã¾
    if(from === to){
      const line = `${fmtMoney(amount)} ${from} = ${fmtMoney(amount)} ${to}`;
      resText.textContent = line;
      rateNote.textContent = 'åŒä¸€é€šè²¨ã®ãŸã‚ 1:1 ã§ã™';
      return;
    }

    // ãƒ¬ãƒ¼ãƒˆå–å¾—ï¼ˆã‚­ãƒ£ãƒƒã‚·ãƒ¥â†’APIï¼‰ã€‚APIå¤±æ•—æ™‚ã¯ã‚­ãƒ£ãƒƒã‚·ãƒ¥ã‚’è©¦ã™
    let rates = null;
    try{
      rates = await fetchRates(from);
    }catch(e){
      const cache = loadLS(LS.CACHE, null);
      if(cache && cache.base === from){
        rates = cache.conversion_rates;
        setStatus('cache', cache.fetchedAt);
      }else{
        formError.textContent = 'ãƒ¬ãƒ¼ãƒˆå–å¾—ã«å¤±æ•—ã—ã¾ã—ãŸï¼ˆå¾Œã§å†è©¦è¡Œã—ã¦ãã ã•ã„ï¼‰';
        resText.textContent = 'â€”';
        rateNote.textContent = '';
        return;
      }
    }

    // å¯¾è±¡ãƒ¬ãƒ¼ãƒˆãŒå­˜åœ¨ã™ã‚‹ã‹
    const r = rates[to];
    if(typeof r !== 'number'){
      formError.textContent = `é¸æŠã—ãŸé€šè²¨ãƒšã‚¢ï¼ˆ${from}â†’${to}ï¼‰ã¯è¨ˆç®—ã§ãã¾ã›ã‚“`;
      resText.textContent = 'â€”';
      rateNote.textContent = '';
      return;
    }

    const result = amount * r;
    const line = `${fmtMoney(amount)} ${from} = ${fmtMoney(result)} ${to}`;
    resText.textContent = line;
    rateNote.textContent = `è¨ˆç®—å¼: amount Ã— rate (${r})`;

    // å±¥æ­´ã«ä¿å­˜ï¼ˆå…ˆé ­ã«è¿½åŠ ã€MAX_HISTORYã§åˆˆã‚Šè¾¼ã¿ï¼‰
    const hist = loadLS(LS.HIST, []);
    hist.unshift({ amount, from, to, rate: r, result: Number(result.toFixed(2)), ts: Date.now() });
    if(hist.length > MAX_HISTORY) hist.length = MAX_HISTORY;
    saveLS(LS.HIST, hist);
    renderHistory();

    // UI çŠ¶æ…‹ä¿å­˜
    saveUI();
  }

  // â€”â€” ã‚¹ãƒ¯ãƒƒãƒ—ï¼ˆFrom/Toå…¥ã‚Œæ›¿ãˆï¼‰ â€”â€”
  function swap(){
    const tmp = fromSel.value;
    fromSel.value = toSel.value;
    toSel.value = tmp;
    announce('From ã¨ To ã‚’å…¥ã‚Œæ›¿ãˆ');
    recalc();
  }

  // â€”â€” ã‚³ãƒ”ãƒ¼ â€”â€”
  async function copyResult(){
    const text = resText.textContent.trim();
    if(!text || text === 'â€”') return;
    try{
      await navigator.clipboard.writeText(text);
      copyBtn.classList.add('good');
      copyBtn.textContent = 'âœ“';
      setTimeout(()=>{ copyBtn.classList.remove('good'); copyBtn.textContent='â§‰'; }, 900);
      announce('çµæœã‚’ã‚³ãƒ”ãƒ¼ã—ã¾ã—ãŸ');
    }catch(_){
      // å¤±æ•—æ™‚ã¯é¸æŠâ†’ã‚¢ãƒ©ãƒ¼ãƒˆã®ç°¡æ˜“ãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯
      alert('ã‚³ãƒ”ãƒ¼ã«å¤±æ•—ã—ã¾ã—ãŸã€‚æ‰‹å‹•ã§é¸æŠã—ã¦ãã ã•ã„ã€‚\\n' + text);
    }
  }

  // â€”â€” UIçŠ¶æ…‹ã®ä¿å­˜/å¾©å…ƒ â€”â€”
  function saveUI(){
    const ui = { from: fromSel.value, to: toSel.value, amount: amountEl.value ? Number(amountEl.value) : '' };
    saveLS(LS.UI, ui);
  }
  function restoreUI(){
    const ui = loadLS(LS.UI, null);
    if(ui){
      if(ui.amount !== '' && ui.amount != null) amountEl.value = ui.amount;
      if(CURRENCIES.includes(ui.from)) fromSel.value = ui.from;
      if(CURRENCIES.includes(ui.to)) toSel.value = ui.to;
    }else{
      // ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆ
      amountEl.value = 10000;
      fromSel.value = 'JPY';
      toSel.value = 'USD';
    }
  }

  // â€”â€” ã‚¢ã‚¯ã‚»ã‚·ãƒ“ãƒªãƒ†ã‚£é€šçŸ¥ â€”â€”
  function announce(msg){ a11y.textContent = msg; }

  // â€”â€” ã‚¤ãƒ™ãƒ³ãƒˆç™»éŒ² â€”â€”
  amountEl.addEventListener('input', ()=> { /* ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ æ›ç®— */ recalc(); });
  fromSel.addEventListener('change', ()=> { recalc(); saveUI(); });
  toSel.addEventListener('change', ()=> { recalc(); saveUI(); });
  swapBtn.addEventListener('click', swap);
  copyBtn.addEventListener('click', copyResult);
  clearHistoryBtn.addEventListener('click', ()=>{
    saveLS(LS.HIST, []);
    renderHistory();
    announce('å±¥æ­´ã‚’ã‚¯ãƒªã‚¢ã—ã¾ã—ãŸ');
  });

  // ã‚·ãƒ§ãƒ¼ãƒˆã‚«ãƒƒãƒˆ: Enter=æ›ç®— / S=ã‚¹ãƒ¯ãƒƒãƒ—
  window.addEventListener('keydown', (e)=>{
    if(e.key === 'Enter'){ e.preventDefault(); recalc(); }
    if(e.key && e.key.toLowerCase() === 's'){ e.preventDefault(); swap(); }
  });

  // â€”â€” åˆæœŸåŒ–ãƒ•ãƒ­ãƒ¼ â€”â€”
  (function init(){
    renderFavorites();   // ãŠæ°—ã«å…¥ã‚Šã‚’èª­ã¿ã¤ã¤ã‚»ãƒ¬ã‚¯ãƒˆã‚‚åˆæœŸåŒ–
    restoreUI();         // UIçŠ¶æ…‹ã‚’åæ˜ 
    renderHistory();     // å±¥æ­´æç”»
    setStatus(null);     // ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹åˆæœŸåŒ–
    recalc();            // åˆå›æ›ç®—ï¼ˆã‚­ãƒ£ãƒƒã‚·ãƒ¥ãŒã‚ã‚Œã°å³è¡¨ç¤ºï¼‰
  })();

})();
</script>
</body>
</html>
